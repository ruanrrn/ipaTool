# 部署检查清单

## ✅ 部署前检查

- [ ] 项目可以正常构建：`pnpm run build`
- [ ] 构建产物在 `dist/` 目录
- [ ] API 函数文件在 `api/` 目录
- [ ] 环境变量已配置（如需要）

## ✅ ESA Pages 部署检查

### 静态网站
- [ ] 上传 `dist/` 目录内容
- [ ] 设置默认文档为 `index.html`
- [ ] 配置自定义域名（可选）
- [ ] 启用 HTTPS

### 函数计算
- [ ] 创建 `api/login` 函数
  - 上传 `api/login.js`
  - 配置运行时：Node.js 20
  - 配置内存：512MB
  - 配置超时：30秒

- [ ] 创建 `api/download` 函数
  - 上传 `api/download.js`
  - 配置运行时：Node.js 20
  - 配置内存：512MB
  - 配置超时：30秒

- [ ] 创建 `api/versions` 函数
  - 上传 `api/versions.js`
  - 配置运行时：Node.js 20
  - 配置内存：512MB
  - 配置超时：30秒

### 路由配置
- [ ] 配置 `/api/*` 路由到函数计算
- [ ] 配置 `/*` 路由到静态文件
- [ ] 测试路由是否正常工作

## ✅ 部署后验证

### 功能测试
- [ ] 访问首页，检查页面是否正常加载
- [ ] 测试登录功能
  - 输入 Apple ID 和密码
  - 检查是否登录成功
  - 刷新页面，检查账户是否保存

- [ ] 测试搜索功能
  - 搜索应用
  - 检查搜索结果是否正确

- [ ] 测试下载功能
  - 选择应用
  - 获取直链
  - 检查浏览器是否开始下载

### 性能检查
- [ ] 页面加载时间 < 3秒
- [ ] API 响应时间 < 2秒
- [ ] 静态资源使用 CDN

### 安全检查
- [ ] 启用 HTTPS
- [ ] 配置 CORS（如需要）
- [ ] 检查敏感信息是否暴露

## ✅ Vercel 部署检查（替代方案）

- [ ] 安装 Vercel CLI：`npm i -g vercel`
- [ ] 登录：`vercel login`
- [ ] 部署：`vercel --prod`
- [ ] 检查部署状态
- [ ] 测试所有功能

## 🐛 常见问题排查

### 问题 1: 页面无法加载
- 检查 `dist/` 目录是否正确上传
- 检查 `index.html` 是否存在
- 检查路由配置是否正确

### 问题 2: API 调用失败
- 检查函数是否正确部署
- 检查函数日志查看错误信息
- 检查路由配置是否正确

### 问题 3: 登录失败
- 检查 `api/login` 函数是否正常
- 检查浏览器控制台错误信息
- 检查 IndexedDB 是否可用

### 问题 4: 下载失败
- 检查 `api/download` 函数是否正常
- 检查账户 Cookie 是否有效
- 检查应用 ID 是否正确

## 📊 监控建议

- 设置错误监控（如 Sentry）
- 监控 API 响应时间
- 监控页面加载时间
- 收集用户反馈

## 🔄 更新部署

当需要更新应用时：

1. 更新代码
2. 运行 `pnpm run build`
3. 上传新的 `dist/` 目录
4. 更新函数计算代码
5. 测试所有功能
6. 通知用户更新

## 📝 部署记录

记录每次部署的信息：

| 日期 | 版本 | 部署平台 | 备注 |
|------|------|----------|------|
| 2025-02-08 | 2.1.0 | ESA Pages | 初始部署 |
| | | | |
