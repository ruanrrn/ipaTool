<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IPA Web Tool</title>
  <link href="./styles.css" rel="stylesheet" />
</head>
<body>
<header class="app-header">
  <h1>IPA 下载 & 签名工具</h1>
  <div class="mode-toggle"><button id="toggleDark">🌙/☀️</button></div>
</header>
<main class="container">
  <section class="card">
    <h2>登录 Apple ID（支持多账号）</h2>
    <form id="loginForm" class="grid">
      <label>邮箱<input type="email" name="email" required /></label>
      <label>密码<input type="password" name="password" required /></label>
      <label>两步验证码<input type="text" name="code" placeholder="如需要" /></label>
      <button type="submit" class="primary">登录</button>
    </form>
    <div class="accounts"><h3>已登录账号</h3><ul id="accountList"></ul></div>
  </section>

  <section class="card">
    <h2>查询版本并下载</h2>
    <form id="queryForm" class="grid">
      <label>使用账号<select id="tokenSelect" required><option value="">请选择登录账号</option></select></label>
      <label>APPID<input id="appid" placeholder="例如：1160172628" required /></label>
      <label>版本（历史版本下拉）<select id="versionSelect"><option value="">请先查询版本</option></select></label>
      <label>appVerId（自动填充）<input id="appVerId" placeholder="external_identifier" /></label>
      <div class="row">
        <button type="button" id="btnFetch" class="secondary">查询版本</button>
        <button type="button" id="btnDirectLink" class="secondary">直链：从苹果服务器下载</button>
        <button type="button" id="btnServerProgress" class="primary">带进度：签名后下载</button>
      </div>
    </form>

    <!-- 始终显示日志/进度区域 -->
    <div id="progressBox" class="progress-box">
      <div class="progress-head">
        <span id="progressStage">等待任务…</span>
        <span id="progressPct">0%</span>
      </div>
      <div class="progress-bar"><div id="progressInner" class="progress-inner" style="width:0%"></div></div>
      <pre id="log" class="log"></pre>
    </div>
  </section>
</main>
<footer class="app-footer"><small>“直链”模式由浏览器原生下载器显示进度；“带进度”模式由后端SSE推送进度与实时日志。</small></footer>
<script type="module" src="./main.js"></script>
</body>
</html>
